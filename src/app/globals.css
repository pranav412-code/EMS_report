@tailwind base;
@tailwind components;
@tailwind utilities;

/* ----------- BASE TOKENS ----------- */
@layer base {
  :root {
    --background: 225 43% 97%;
    --foreground: 220 13% 18%;
    --card: 0 0% 100%;
    --card-foreground: 220 13% 18%;
    --popover: 0 0% 100%;
    --popover-foreground: 220 13% 18%;
    --primary: 213 65% 33%;
    --primary-foreground: 0 0% 98%;
    --secondary: 220 13% 91%;
    --secondary-foreground: 220 13% 18%;
    --muted: 220 9% 90%;
    --muted-foreground: 220 9% 45%;
    --accent: 14 99% 65%;
    --accent-foreground: 0 0% 98%;
    --destructive: 7 80% 57%;
    --destructive-foreground: 0 0% 98%;
    --border: 220 13% 88%;
    --input: 220 13% 93%;
    --ring: 213 65% 33%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 220 13% 10%;
    --foreground: 0 0% 98%;
    --card: 220 13% 10%;
    --card-foreground: 0 0% 98%;
    --popover: 220 13% 10%;
    --popover-foreground: 0 0% 98%;
    --primary: 213 65% 73%;
    --primary-foreground: 213 65% 13%;
    --secondary: 220 13% 20%;
    --secondary-foreground: 0 0% 98%;
    --muted: 220 13% 20%;
    --muted-foreground: 220 9% 65%;
    --accent: 220 13% 20%;
    --accent-foreground: 0 0% 98%;
    --destructive: 7 80% 57%;
    --destructive-foreground: 0 0% 98%;
    --border: 220 13% 25%;
    --input: 220 13% 25%;
    --ring: 213 65% 73%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }

  h2 {
    @apply text-lg font-bold text-primary;
  }

  h3 {
    @apply text-base font-semibold;
  }
}

/* ----------- COMPONENTS ----------- */
@layer components {
  .report-container {
    @apply max-w-7xl mx-auto my-6 bg-card shadow-lg rounded-2xl overflow-hidden;
  }

  .report-header {
    background: linear-gradient(90deg, hsl(var(--primary)), #2c6bc2);
    @apply text-primary-foreground p-6 flex flex-col gap-4 items-start;
  }

  .report-header h1 {
    @apply text-2xl font-bold m-0 mb-1.5;
  }

  .report-header .right {
    @apply flex gap-2 flex-wrap items-center;
  }

  .badge {
    @apply bg-card text-primary rounded-full px-2.5 py-1.5 font-bold text-xs;
  }

  .meta-bar {
    @apply flex flex-wrap gap-4 bg-primary/5 p-3 px-5 border-b;
  }

  .meta-bar .logo-col {
    @apply w-full md:w-32;
  }

  .meta-bar .details-col {
    @apply flex-1 flex flex-col gap-y-2 justify-center;
  }

  .meta-bar .item {
    @apply flex items-start gap-2 text-sm;
  }

  .meta-bar .label {
    @apply font-semibold text-slate-700 whitespace-nowrap;
  }

  .meta-bar .value-col {
    @apply flex-1;
  }

  .report-section {
    @apply p-5 border-b;
  }

  .report-section:last-of-type {
    @apply border-b-0;
  }

  .section-controls {
    @apply absolute top-4 right-4 z-20 flex items-center gap-1 rounded-md bg-background p-1 border shadow-sm opacity-0 group-hover/section:opacity-100 transition-opacity;
  }

  .draggable-section[data-locked='true']:hover .section-controls {
    @apply opacity-100;
  }

  .draggable-section[data-locked='true'] {
    @apply bg-secondary/30;
  }

  .drag-handle {
    @apply cursor-move text-muted-foreground p-1;
  }

  .drag-handle:hover {
    @apply text-foreground;
  }

  .report-section h2 {
    @apply mb-3 flex items-center gap-2;
  }

  .kpis {
    @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3;
  }

  .kpi {
    @apply bg-card border rounded-xl p-3;
  }

  .kpi .title {
    @apply text-xs text-muted-foreground;
  }

  .kpi .value {
    @apply text-xl font-bold mt-1;
  }

  .kpi .hint {
    @apply text-xs mt-1 text-slate-400;
  }

  .kpi .good {
    @apply text-green-600 font-semibold;
  }

  .kpi .bad {
    @apply text-red-600 font-semibold;
  }

  .grid-2 {
    @apply grid grid-cols-1 md:grid-cols-2 gap-4;
  }

  .grid-2.equal {
    @apply md:grid-cols-2;
  }

  .grid-3 {
    @apply grid grid-cols-1 md:grid-cols-3 gap-3;
  }

  .chart-card {
    @apply bg-card border rounded-xl p-3.5 min-h-[120px] relative;
  }

  .chart-card h3 {
    @apply mb-2.5 flex items-center gap-2;
  }

  .subgrid {
    @apply grid grid-cols-1 lg:grid-cols-2 gap-3;
  }

  .subgrid-3 {
    @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3;
  }

  .chart-slot {
    border: 2px dashed hsl(var(--primary) / 0.2);
    @apply rounded-lg min-h-[220px] flex items-center justify-center p-3 bg-primary/5 overflow-hidden relative transition-colors;
  }

  .chart-slot.small {
    @apply min-h-[140px];
  }

  .chart-slot.drag-over {
    background: hsl(var(--primary) / 0.1);
    border-color: hsl(var(--primary) / 0.5);
  }

  .chart-slot img {
    @apply max-w-full max-h-full block m-auto object-contain;
  }

  .chart-tools {
    @apply absolute right-2.5 top-2.5 flex gap-2;
  }

  .chart-tools .btn {
    @apply h-auto;
  }

  .chart-tools .btn.danger {
    @apply bg-destructive/10 border-destructive/20 text-destructive;
  }

  .chart-tools .btn.danger:hover {
    @apply bg-destructive/20;
  }

  .remarks {
    @apply mt-2.5 bg-secondary/30 border border-dashed rounded-lg p-2.5 min-h-[80px];
  }

  .editable-field {
    @apply outline-none w-full bg-transparent;
  }

  .editable-field:not([disabled]):focus {
    @apply bg-yellow-50/80 ring-2 ring-yellow-400 rounded-sm;
  }

.tag {
  @apply inline-flex items-center justify-center gap-1.5 bg-primary/10 text-primary-foreground border border-primary-foreground/30 rounded-full px-4 py-2 text-xs font-medium min-h-8 overflow-visible;
  transform: translateZ(0);
}
  .tag .editable-field {
    @apply placeholder:text-primary-foreground/50 text-primary-foreground;
  }

  .tag:has(button) {
    @apply p-0;
  }

  .tag button {
    @apply text-primary-foreground bg-transparent border-transparent hover:bg-primary/20;
  }

  .tag button.tag {
    @apply border-primary-foreground/30 px-2.5;
  }

  .tag button:hover {
    @apply text-primary-foreground;
  }

  .tag #date,
  .tag #date:hover {
    @apply bg-card text-card-foreground border-border;
  }

  .report-footer {
    @apply p-4 px-5 bg-slate-100 text-slate-500 text-xs text-center;
  }

  /* Hide editor-only controls when we are preparing/printing PDF via class */
  .printing-pdf .section-controls,
  .printing-pdf .add-section-container,
  .printing-pdf .block-toolbar,
  .printing-pdf .add-block-btn,
  .printing-pdf .chart-tools,
  .printing-pdf *[data-hide-print='true'] {
    display: none !important;
  }
}

/* ----------- PRINT RULES ----------- */
@media print {
  body {
    background: #fff;
  }

  .report-container {
    box-shadow: none;
    border-radius: 0;
    margin: 0;
    max-width: 100%;
    border: none;
  }

  .action-bar {
    display: none !important;
  }

  .report-section {
    page-break-inside: avoid;
  }

  .chart-card,
  .kpi {
    page-break-inside: avoid;
  }

  .section-controls,
  .add-section-container,
  .block-toolbar,
  .add-block-btn,
  .chart-tools,
  *[data-hide-print='true'] {
    display: none !important;
  }
}

@media print {
  @page { margin: 0; }
  body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
  [data-hide-print], .section-controls, .add-section-container, .action-bar {
    display: none !important;
  }
  .report-container {
    background: white !important;
  }
}

/* Force background colors */
.report-header {
  -webkit-print-color-adjust: exact !important;
  background: #1e40af !important; /* your blue */
}

/* ============ PERFECT PDF HEADER â€“ FINAL FIX (2025) ============ */

/* 1. Remove extra top space caused by flex gaps & margins */
.report-header {
  @apply p-6 pt-8 pb-10 gap-6;        /* increase bottom padding a bit */
  margin-top: 0 !important;
  padding-top: 2rem !important;       /* forces consistent top spacing */
}

/* 2. Force ALL tags (including date) to render perfectly in PDF */
.report-header .tag,
.report-header .tag *,
.report-header [role="button"],
.report-header button {
  overflow: visible !important;
  min-height: 36px !important;
  padding-top: 8px !important;
  padding-bottom: 8px !important;
  line-height: 1.4 !important;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  -webkit-print-color-adjust: exact !important;
  print-color-adjust: exact !important;
}

/* 3. Special fix for the Date Range button (the one that disappears) */
.report-header #date,
.report-header button:has(.lucide-calendar) {
  background: white !important;
  color: #1e293b !important;
  border: 1px solid #e2e8f0 !important;
  min-height: 38px !important;
  overflow: visible !important;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
}

/* 4. Ensure the calendar icon shows in PDF */
.report-header .lucide-calendar {
  color: #1e293b !important;
}